<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
        integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
        crossorigin="" />
    <title>Happy Place</title>
    <style>
        #mapid {
            height: 800px;
            width: 800px;
        }
    </style>
</head>

<body>
    <a href="html/admin/">Administrator</a>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
        crossorigin=""></script>

    

    <div id="mapid"></div>

    <script>
        var map = L.map('mapid').setView([51.505, -0.09], 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);



        function loadStudents() {
            const response = fetch('http://localhost/php/place/php/rest/student/')
            response.then(response /*parameter*/ => response.json() /*body*/ )
                .then(json /*parameter*/ => { // body
                
                    json.forEach(student => {

                        const r = fetch(`https://nominatim.openstreetmap.org/search?city=${student.city}&postalcode=${student.plz}&format=geojson`)
                            .then(response => response.json() )
                            .then(json => {

                                lat=json.features[0].geometry.coordinates[1];
                                lon=json.features[0].geometry.coordinates[0];

                                L.marker([lat, lon]).addTo(map)
                                    .bindPopup(student.name)
                                    .openPopup();

                            })
                        }
                   
                    )
                })
                .catch(err => console.log('Request Failed', err)); // Catch errors
        }


        loadStudents();
    </script>



</body>

</html>